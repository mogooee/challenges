{"ast":null,"code":"import{ANIMATION,COLORS,SIZE}from'../../constants/producing-chart/index';const drawPieChart=(canvas,data,animationId)=>{const labels=Object.keys(data);const ratios=Object.values(data);const sum=ratios.reduce((acc,cur)=>acc+cur,0);let startAngle=0;let labelX=0;const labelY=SIZE.CANVAS.HEIGHT-SIZE.PIE_CHART.OFFSET_LABEL_Y;const labelWidth=SIZE.CANVAS.WIDTH/labels.length;const drawPie=(index,startAngle,endAngle,color)=>{let movingAngle=startAngle;const RADIAN=Math.PI/180;const[PIE_X,PIE_Y]=[SIZE.CANVAS.WIDTH/2,SIZE.CANVAS.HEIGHT/2];const animation=()=>{canvas.beginPath();canvas.moveTo(PIE_X,PIE_Y);canvas.arc(PIE_X,PIE_Y,SIZE.PIE_CHART.RADIUS,startAngle*RADIAN,movingAngle*RADIAN);canvas.stroke();if(movingAngle===endAngle){cancelAnimationFrame(animationId.current[index]);return;}movingAngle=movingAngle<endAngle?movingAngle+ANIMATION.PIE_CHART_MOVING_ANGLE:endAngle;animationId.current[index]=requestAnimationFrame(animation);};animation();// 차트 내 색상 지표\ncanvas.beginPath();canvas.moveTo(PIE_X,PIE_Y);const deg=startAngle+(endAngle-startAngle)/2;const rectX=Math.cos(deg*RADIAN)*SIZE.PIE_CHART.RADIUS*0.7+PIE_X;const rectY=Math.sin(deg*RADIAN)*SIZE.PIE_CHART.RADIUS*0.7+PIE_Y;canvas.rect(rectX,rectY,SIZE.PIE_CHART.COLOR_BOX,SIZE.PIE_CHART.COLOR_BOX);canvas.fillStyle=color;canvas.fill();canvas.closePath();};const drawLabels=(x,y,label,value)=>{// label 외부 사각형\ncanvas.beginPath();canvas.strokeRect(x,y-(SIZE.PIE_CHART.LABELS_HEIGHT-SIZE.PIE_CHART.COLOR_BOX)/2,labelWidth,SIZE.PIE_CHART.LABELS_HEIGHT);// label 색상 지표\ncanvas.beginPath();const stringHalfLen=(labelWidth-(SIZE.PIE_CHART.COLOR_BOX+SIZE.PIE_CHART.OFFSET_LABEL_X+Math.round(canvas.measureText(label).width)))/2;canvas.rect(x+stringHalfLen,y-SIZE.PIE_CHART.COLOR_BOX/2,SIZE.PIE_CHART.COLOR_BOX,SIZE.PIE_CHART.COLOR_BOX);canvas.fill();// label 텍스트\ncanvas.font='14px serif';canvas.fillStyle='black';canvas.fillText(label,x+stringHalfLen+SIZE.PIE_CHART.COLOR_BOX+SIZE.PIE_CHART.OFFSET_LABEL_X,y+SIZE.PIE_CHART.COLOR_BOX/2,labelWidth);// 파이 수치\ncanvas.fillText(String(value),x+stringHalfLen+SIZE.PIE_CHART.COLOR_BOX+SIZE.PIE_CHART.OFFSET_LABEL_X,y+SIZE.PIE_CHART.LABELS_HEIGHT/2+SIZE.PIE_CHART.OFFSET_VALUE,labelWidth);};ratios.forEach((ratio,i)=>{const currentAngle=Math.round(ratio/sum*360);const endAngle=startAngle+currentAngle;drawPie(i,startAngle,endAngle,COLORS[i]);drawLabels(labelX,labelY,labels[i],ratio);startAngle+=currentAngle;labelX+=labelWidth;});};export default drawPieChart;","map":{"version":3,"names":["ANIMATION","COLORS","SIZE","drawPieChart","canvas","data","animationId","labels","Object","keys","ratios","values","sum","reduce","acc","cur","startAngle","labelX","labelY","CANVAS","HEIGHT","PIE_CHART","OFFSET_LABEL_Y","labelWidth","WIDTH","length","drawPie","index","endAngle","color","movingAngle","RADIAN","Math","PI","PIE_X","PIE_Y","animation","beginPath","moveTo","arc","RADIUS","stroke","cancelAnimationFrame","current","PIE_CHART_MOVING_ANGLE","requestAnimationFrame","deg","rectX","cos","rectY","sin","rect","COLOR_BOX","fillStyle","fill","closePath","drawLabels","x","y","label","value","strokeRect","LABELS_HEIGHT","stringHalfLen","OFFSET_LABEL_X","round","measureText","width","font","fillText","String","OFFSET_VALUE","forEach","ratio","i","currentAngle"],"sources":["/home/runner/work/challenges/challenges/src/utils/producing-chart/drawPieChart.ts"],"sourcesContent":["import { ChartDataType } from '../../components/producing-chart/ChartMaker';\nimport { ANIMATION, COLORS, SIZE } from '../../constants/producing-chart/index';\n\nconst drawPieChart = (\n  canvas: CanvasRenderingContext2D,\n  data: ChartDataType,\n  animationId: React.MutableRefObject<number[]>,\n) => {\n  const labels: string[] = Object.keys(data);\n  const ratios: number[] = Object.values(data);\n  const sum = ratios.reduce((acc, cur) => acc + cur, 0);\n\n  let startAngle = 0;\n  let labelX = 0;\n  const labelY = SIZE.CANVAS.HEIGHT - SIZE.PIE_CHART.OFFSET_LABEL_Y;\n  const labelWidth = SIZE.CANVAS.WIDTH / labels.length;\n\n  const drawPie = (index: number, startAngle: number, endAngle: number, color: string) => {\n    let movingAngle = startAngle;\n\n    const RADIAN = Math.PI / 180;\n    const [PIE_X, PIE_Y] = [SIZE.CANVAS.WIDTH / 2, SIZE.CANVAS.HEIGHT / 2];\n\n    const animation = () => {\n      canvas.beginPath();\n      canvas.moveTo(PIE_X, PIE_Y);\n      canvas.arc(PIE_X, PIE_Y, SIZE.PIE_CHART.RADIUS, startAngle * RADIAN, movingAngle * RADIAN);\n      canvas.stroke();\n\n      if (movingAngle === endAngle) {\n        cancelAnimationFrame(animationId.current[index]);\n        return;\n      }\n\n      movingAngle = movingAngle < endAngle ? movingAngle + ANIMATION.PIE_CHART_MOVING_ANGLE : endAngle;\n      animationId.current[index] = requestAnimationFrame(animation);\n    };\n\n    animation();\n\n    // 차트 내 색상 지표\n    canvas.beginPath();\n    canvas.moveTo(PIE_X, PIE_Y);\n    const deg = startAngle + (endAngle - startAngle) / 2;\n    const rectX = Math.cos(deg * RADIAN) * SIZE.PIE_CHART.RADIUS * 0.7 + PIE_X;\n    const rectY = Math.sin(deg * RADIAN) * SIZE.PIE_CHART.RADIUS * 0.7 + PIE_Y;\n    canvas.rect(rectX, rectY, SIZE.PIE_CHART.COLOR_BOX, SIZE.PIE_CHART.COLOR_BOX);\n    canvas.fillStyle = color;\n    canvas.fill();\n\n    canvas.closePath();\n  };\n\n  const drawLabels = (x: number, y: number, label: string, value: number) => {\n    // label 외부 사각형\n    canvas.beginPath();\n    canvas.strokeRect(\n      x,\n      y - (SIZE.PIE_CHART.LABELS_HEIGHT - SIZE.PIE_CHART.COLOR_BOX) / 2,\n      labelWidth,\n      SIZE.PIE_CHART.LABELS_HEIGHT,\n    );\n\n    // label 색상 지표\n    canvas.beginPath();\n    const stringHalfLen =\n      (labelWidth -\n        (SIZE.PIE_CHART.COLOR_BOX + SIZE.PIE_CHART.OFFSET_LABEL_X + Math.round(canvas.measureText(label).width))) /\n      2;\n    canvas.rect(\n      x + stringHalfLen,\n      y - SIZE.PIE_CHART.COLOR_BOX / 2,\n      SIZE.PIE_CHART.COLOR_BOX,\n      SIZE.PIE_CHART.COLOR_BOX,\n    );\n    canvas.fill();\n\n    // label 텍스트\n    canvas.font = '14px serif';\n    canvas.fillStyle = 'black';\n    canvas.fillText(\n      label,\n      x + stringHalfLen + SIZE.PIE_CHART.COLOR_BOX + SIZE.PIE_CHART.OFFSET_LABEL_X,\n      y + SIZE.PIE_CHART.COLOR_BOX / 2,\n      labelWidth,\n    );\n\n    // 파이 수치\n    canvas.fillText(\n      String(value),\n      x + stringHalfLen + SIZE.PIE_CHART.COLOR_BOX + SIZE.PIE_CHART.OFFSET_LABEL_X,\n      y + SIZE.PIE_CHART.LABELS_HEIGHT / 2 + SIZE.PIE_CHART.OFFSET_VALUE,\n      labelWidth,\n    );\n  };\n\n  ratios.forEach((ratio, i) => {\n    const currentAngle = Math.round((ratio / sum) * 360);\n    const endAngle = startAngle + currentAngle;\n    drawPie(i, startAngle, endAngle, COLORS[i]);\n    drawLabels(labelX, labelY, labels[i], ratio);\n    startAngle += currentAngle;\n    labelX += labelWidth;\n  });\n};\n\nexport default drawPieChart;\n"],"mappings":"AACA,OAASA,SAAS,CAAEC,MAAM,CAAEC,IAAI,KAAQ,uCAAuC,CAE/E,KAAM,CAAAC,YAAY,CAAGA,CACnBC,MAAgC,CAChCC,IAAmB,CACnBC,WAA6C,GAC1C,CACH,KAAM,CAAAC,MAAgB,CAAGC,MAAM,CAACC,IAAI,CAACJ,IAAI,CAAC,CAC1C,KAAM,CAAAK,MAAgB,CAAGF,MAAM,CAACG,MAAM,CAACN,IAAI,CAAC,CAC5C,KAAM,CAAAO,GAAG,CAAGF,MAAM,CAACG,MAAM,CAAC,CAACC,GAAG,CAAEC,GAAG,GAAKD,GAAG,CAAGC,GAAG,CAAE,CAAC,CAAC,CAErD,GAAI,CAAAC,UAAU,CAAG,CAAC,CAClB,GAAI,CAAAC,MAAM,CAAG,CAAC,CACd,KAAM,CAAAC,MAAM,CAAGhB,IAAI,CAACiB,MAAM,CAACC,MAAM,CAAGlB,IAAI,CAACmB,SAAS,CAACC,cAAc,CACjE,KAAM,CAAAC,UAAU,CAAGrB,IAAI,CAACiB,MAAM,CAACK,KAAK,CAAGjB,MAAM,CAACkB,MAAM,CAEpD,KAAM,CAAAC,OAAO,CAAGA,CAACC,KAAa,CAAEX,UAAkB,CAAEY,QAAgB,CAAEC,KAAa,GAAK,CACtF,GAAI,CAAAC,WAAW,CAAGd,UAAU,CAE5B,KAAM,CAAAe,MAAM,CAAGC,IAAI,CAACC,EAAE,CAAG,GAAG,CAC5B,KAAM,CAACC,KAAK,CAAEC,KAAK,CAAC,CAAG,CAACjC,IAAI,CAACiB,MAAM,CAACK,KAAK,CAAG,CAAC,CAAEtB,IAAI,CAACiB,MAAM,CAACC,MAAM,CAAG,CAAC,CAAC,CAEtE,KAAM,CAAAgB,SAAS,CAAGA,CAAA,GAAM,CACtBhC,MAAM,CAACiC,SAAS,CAAC,CAAC,CAClBjC,MAAM,CAACkC,MAAM,CAACJ,KAAK,CAAEC,KAAK,CAAC,CAC3B/B,MAAM,CAACmC,GAAG,CAACL,KAAK,CAAEC,KAAK,CAAEjC,IAAI,CAACmB,SAAS,CAACmB,MAAM,CAAExB,UAAU,CAAGe,MAAM,CAAED,WAAW,CAAGC,MAAM,CAAC,CAC1F3B,MAAM,CAACqC,MAAM,CAAC,CAAC,CAEf,GAAIX,WAAW,GAAKF,QAAQ,CAAE,CAC5Bc,oBAAoB,CAACpC,WAAW,CAACqC,OAAO,CAAChB,KAAK,CAAC,CAAC,CAChD,OACF,CAEAG,WAAW,CAAGA,WAAW,CAAGF,QAAQ,CAAGE,WAAW,CAAG9B,SAAS,CAAC4C,sBAAsB,CAAGhB,QAAQ,CAChGtB,WAAW,CAACqC,OAAO,CAAChB,KAAK,CAAC,CAAGkB,qBAAqB,CAACT,SAAS,CAAC,CAC/D,CAAC,CAEDA,SAAS,CAAC,CAAC,CAEX;AACAhC,MAAM,CAACiC,SAAS,CAAC,CAAC,CAClBjC,MAAM,CAACkC,MAAM,CAACJ,KAAK,CAAEC,KAAK,CAAC,CAC3B,KAAM,CAAAW,GAAG,CAAG9B,UAAU,CAAG,CAACY,QAAQ,CAAGZ,UAAU,EAAI,CAAC,CACpD,KAAM,CAAA+B,KAAK,CAAGf,IAAI,CAACgB,GAAG,CAACF,GAAG,CAAGf,MAAM,CAAC,CAAG7B,IAAI,CAACmB,SAAS,CAACmB,MAAM,CAAG,GAAG,CAAGN,KAAK,CAC1E,KAAM,CAAAe,KAAK,CAAGjB,IAAI,CAACkB,GAAG,CAACJ,GAAG,CAAGf,MAAM,CAAC,CAAG7B,IAAI,CAACmB,SAAS,CAACmB,MAAM,CAAG,GAAG,CAAGL,KAAK,CAC1E/B,MAAM,CAAC+C,IAAI,CAACJ,KAAK,CAAEE,KAAK,CAAE/C,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAElD,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAC,CAC7EhD,MAAM,CAACiD,SAAS,CAAGxB,KAAK,CACxBzB,MAAM,CAACkD,IAAI,CAAC,CAAC,CAEblD,MAAM,CAACmD,SAAS,CAAC,CAAC,CACpB,CAAC,CAED,KAAM,CAAAC,UAAU,CAAGA,CAACC,CAAS,CAAEC,CAAS,CAAEC,KAAa,CAAEC,KAAa,GAAK,CACzE;AACAxD,MAAM,CAACiC,SAAS,CAAC,CAAC,CAClBjC,MAAM,CAACyD,UAAU,CACfJ,CAAC,CACDC,CAAC,CAAG,CAACxD,IAAI,CAACmB,SAAS,CAACyC,aAAa,CAAG5D,IAAI,CAACmB,SAAS,CAAC+B,SAAS,EAAI,CAAC,CACjE7B,UAAU,CACVrB,IAAI,CAACmB,SAAS,CAACyC,aACjB,CAAC,CAED;AACA1D,MAAM,CAACiC,SAAS,CAAC,CAAC,CAClB,KAAM,CAAA0B,aAAa,CACjB,CAACxC,UAAU,EACRrB,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAGlD,IAAI,CAACmB,SAAS,CAAC2C,cAAc,CAAGhC,IAAI,CAACiC,KAAK,CAAC7D,MAAM,CAAC8D,WAAW,CAACP,KAAK,CAAC,CAACQ,KAAK,CAAC,CAAC,EAC1G,CAAC,CACH/D,MAAM,CAAC+C,IAAI,CACTM,CAAC,CAAGM,aAAa,CACjBL,CAAC,CAAGxD,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAG,CAAC,CAChClD,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CACxBlD,IAAI,CAACmB,SAAS,CAAC+B,SACjB,CAAC,CACDhD,MAAM,CAACkD,IAAI,CAAC,CAAC,CAEb;AACAlD,MAAM,CAACgE,IAAI,CAAG,YAAY,CAC1BhE,MAAM,CAACiD,SAAS,CAAG,OAAO,CAC1BjD,MAAM,CAACiE,QAAQ,CACbV,KAAK,CACLF,CAAC,CAAGM,aAAa,CAAG7D,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAGlD,IAAI,CAACmB,SAAS,CAAC2C,cAAc,CAC5EN,CAAC,CAAGxD,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAG,CAAC,CAChC7B,UACF,CAAC,CAED;AACAnB,MAAM,CAACiE,QAAQ,CACbC,MAAM,CAACV,KAAK,CAAC,CACbH,CAAC,CAAGM,aAAa,CAAG7D,IAAI,CAACmB,SAAS,CAAC+B,SAAS,CAAGlD,IAAI,CAACmB,SAAS,CAAC2C,cAAc,CAC5EN,CAAC,CAAGxD,IAAI,CAACmB,SAAS,CAACyC,aAAa,CAAG,CAAC,CAAG5D,IAAI,CAACmB,SAAS,CAACkD,YAAY,CAClEhD,UACF,CAAC,CACH,CAAC,CAEDb,MAAM,CAAC8D,OAAO,CAAC,CAACC,KAAK,CAAEC,CAAC,GAAK,CAC3B,KAAM,CAAAC,YAAY,CAAG3C,IAAI,CAACiC,KAAK,CAAEQ,KAAK,CAAG7D,GAAG,CAAI,GAAG,CAAC,CACpD,KAAM,CAAAgB,QAAQ,CAAGZ,UAAU,CAAG2D,YAAY,CAC1CjD,OAAO,CAACgD,CAAC,CAAE1D,UAAU,CAAEY,QAAQ,CAAE3B,MAAM,CAACyE,CAAC,CAAC,CAAC,CAC3ClB,UAAU,CAACvC,MAAM,CAAEC,MAAM,CAAEX,MAAM,CAACmE,CAAC,CAAC,CAAED,KAAK,CAAC,CAC5CzD,UAAU,EAAI2D,YAAY,CAC1B1D,MAAM,EAAIM,UAAU,CACtB,CAAC,CAAC,CACJ,CAAC,CAED,cAAe,CAAApB,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}